<h1>Bagatelle gallery</h1>

<!-- Multi-modal RAG -->
<section id="retrieval-section" aria-label="Image retrieval" class="w3-container w3-border">
    <h3>Search for images: </h3>
    <form id="retrieve-form" action="/retrieve" method="POST" style="display:flex; gap:8px; align-items:center;">
         <!-- Slider to set percentage of visual vs textual data -->
        <div class="slider-container">
            <div class="slider-row">
              <label for="slider">Write-ups weight:</label>
              <input id="slider" type="range" min="0" max="1" step="0.1" value="0" />
              <span id="sliderValue" class="slider-value">0</span>
            </div>
        </div>
         <!-- LLM refine search checkbox + radio options -->
        <div id="llm-refine-wrapper" style="display:flex; align-items:center; gap:12px; margin-left:8px;">
            <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                <input type="checkbox" id="llm-checkbox" name="use_llm_refine" checked/>
                <span>Use LLM to refine search</span>
            </label>
            <div id="llm-options" style="display:flex; align-items:center; gap:8px;">
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="radio" name="llm_refine_choice" value="claude-sonnet-4"
                           id="llm-1-radio" checked/>
                    <span>claude-sonnet-4</span>
                </label>
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="radio" name="llm_refine_choice" value="gpt-5" id="llm-2-radio"/>
                    <span>gpt-5</span>
                </label>
            </div>
        </div>
        <label for="query-input" style="display:none;">Question</label>
        <input id="query-input" name="question" type="search" placeholder="Enter your question..."
               style="flex:1; padding:8px;" autocomplete="off" required/>
        <label for="k-input" style="display:none;">K</label>
        <input id="k-input" name="k" type="number" min="1" max="10" value="5"
               style="width:80px; padding:8px;" required/>
        <button type="submit" id="retrieve-btn" style="padding:8px 12px;">Retrieve</button>
    </form>
    <div id="retrieve-status" style="margin-top:8px; color:#666; font-size:90%;"></div>
</section>

<!-- Selected images (basket) -->
<section class="w3-container w3-border">
    <h3>You selected: </h3>
    <div id="bagatelle-selected">
        <div id="selected-image-container" class="image-container">
        </div>
    </div>
</section>

<!-- Workshop generator -->
<section id="workshop-section" class="w3-container w3-border" style="margin-top:16px;">
    <h3>Create a workshop programme from selected images</h3>
    <form id="workshop-form"  action="/generate_program" method="POST" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <label for="llm-selector" style="display:flex; flex-direction:column; font-size:90%;">LLM
        <div class="llm-selector">
            <label>
                <input type="radio" name="llm_model" value="claude-sonnet-4" checked>
                claude-sonnet-4
            </label>
            <label>
                <input type="radio" name="llm_model" value="gpt-5">
                gpt-5
            </label>
        </div>
        </label>

        <label for="num-days" style="display:flex; flex-direction:column; font-size:90%;">
            Num days
            <input id="num-days" name="num_days" type="number" min="1" max="14" value="3" style="width:80px; padding:6px;">
        </label>

        <label for="theme" style="display:flex; flex-direction:column; font-size:90%; flex:1;">
            Theme of workshop
            <input id="theme" name="theme" type="text" placeholder="e.g. Taking Flight" style="padding:6px;">
        </label>

        <label for="audience" style="display:flex; flex-direction:column; font-size:90%; flex:1;">
            Type of audience
            <input id="audience" name="audience" type="text" placeholder="e.g. pathology residents" style="padding:6px;">
        </label>

        <button type="submit" id="workshop-submit" style="padding:8px 4px;margin-top:16px;">Generate programme</button>
    </form>

    <div id="workshop-status" style="margin-top:8px; color:#666; font-size:90%;"></div>
    <div id="workshop-result" style="margin-top:12px;">
        <!-- Toolbar: hidden when no content -->
        <div id="workshop-result-toolbar" class="w3-light-grey w3-small" style="display:none; width:100%; overflow-x:auto;
            white-space:nowrap; gap:8px; margin-bottom:8px;">
            <button id="workshop-download" class="w3-button w3-padding-small" style="padding:6px 10px;">Download as HTML</button>
            <button id="workshop-clear" class="w3-button w3-padding-small" style="padding:6px 10px;">Clear</button>
        </div>
        <!-- Formatted result area -->
        <div id="workshop-result-content"
             style="padding:16px; border:1px solid #e0e0e0; border-radius:6px; background:#fff;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.04); font-family: Arial, sans-serif; line-height:1.45;
                    color:#222; max-width:100%; overflow:auto;">
            <!-- Program HTML injection goes here -->
        </div>
   </div>
</section>

<!-- Discuss with LLM block -->
{#<section class="w3-container w3-border llm-block">#}
{#    <h3>Discuss selected images with LLM: </h3>#}
{#    <div class="chat-container box">#}
{#        <div id="rag-chat-box" class="chat-box">#}
{#        </div>#}
{#        <form id="rag-chat-form" action="/ask_llm" method="POST">#}
{#            <input type="text" id="rag-user-input" placeholder="Enter your question..." autocomplete="off">#}
{#            <button type="submit" class="button">Send</button>#}
{#        </form>#}
{#    </div>#}
{#</section>#}

<section class="w3-block w3-border">
    <h3>Image catalogue: </h3>
    <div id="bagatelle-container">
        <div id="settings-container">
            <div id="checkbox-container" class="checkbox-wrapper-14"></div>
            <button id="update-button" style="float: right; padding: 6px;">â–¼ Update</button>
        </div>
        <div id="image-container" class="image-container">
        </div>
    </div>
</section>

<!-- Back Button -->
<a href="{{ url_for('back') }}" class="button" style="float:right;">Back</a>
<script>
    let images = {{ bagatelle_data | safe }}
</script>
<script src="/static/js/gallery.js" type="module"></script>

