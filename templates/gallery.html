<h1>Bagatelle gallery</h1>

<section id="retrieval-section" aria-label="Image retrieval" class="w3-container w3-border">
    <h3>Search for images: </h3>
    <form id="retrieve-form" action="/retrieve" method="POST" style="display:flex; gap:8px; align-items:center;">
         <!-- Slider to set percentage of visual vs textual data -->
        <div class="slider-container">
            <div class="slider-row">
              <label for="slider">Write-ups weight:</label>
              <input id="slider" type="range" min="0" max="1" step="0.1" value="0" />
              <span id="sliderValue" class="slider-value">0</span>
            </div>
        </div>
         <!-- LLM refine search checkbox + radio options -->
        <div id="llm-refine-wrapper" style="display:flex; align-items:center; gap:12px; margin-left:8px;">
            <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                <input type="checkbox" id="llm-checkbox" name="use_llm_refine" checked/>
                <span>Use LLM to refine search</span>
            </label>
            <div id="llm-options" style="display:flex; align-items:center; gap:8px;">
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="radio" name="llm_refine_choice" value="claude-sonnet-4"
                           id="llm-1-radio" checked/>
                    <span>claude-sonnet-4</span>
                </label>
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="radio" name="llm_refine_choice" value="gpt-5" id="llm-2-radio"/>
                    <span>gpt-5</span>
                </label>
            </div>
        </div>
        <label for="query-input" style="display:none;">Question</label>
        <input id="query-input" name="question" type="search" placeholder="Enter your question..."
               style="flex:1; padding:8px;" autocomplete="off" required/>
        <label for="k-input" style="display:none;">K</label>
        <input id="k-input" name="k" type="number" min="1" max="10" value="5"
               style="width:80px; padding:8px;" required/>
        <button type="submit" id="retrieve-btn" style="padding:8px 12px;">Retrieve</button>
    </form>
    <div id="retrieve-status" style="margin-top:8px; color:#666; font-size:90%;"></div>
</section>

<section class="w3-container w3-border">
    <h3>You selected: </h3>
    <div id="bagatelle-selected">
        <div id="selected-image-container" class="image-container">
        </div>
    </div>
</section>

<section class="w3-container w3-border llm-block">
    <h3>Discuss selected images with LLM: </h3>
    <div class="chat-container box">
        <div id="rag-chat-box" class="chat-box">
        </div>
        <form id="rag-chat-form" action="/ask_llm" method="POST">
            <div class="llm-selector">
                <label><strong>Select LLM:</strong></label><br>
                <label>
                    <input type="radio" name="llm_model" value="claude-sonnet-4" checked>
                    claude-sonnet-4
                </label>
                <label>
                    <input type="radio" name="llm_model" value="gpt-5">
                    gpt-5
                </label>
            </div>
            <input type="text" id="rag-user-input" placeholder="Enter your question..." autocomplete="off">
            <button type="submit" class="button">Send</button>
        </form>
    </div>
</section>

<section class="w3-block w3-border">
    <h3>Image catalogue: </h3>
    <div id="bagatelle-container">
        <div id="settings-container">
            <div id="checkbox-container" class="checkbox-wrapper-14"></div>
            <button id="update-button" style="float: right; padding: 6px;">â–¼ Update</button>
        </div>
        <div id="image-container" class="image-container">
        </div>
    </div>
</section>

<!-- Back Button -->
<a href="{{ url_for('back') }}" class="button" style="float:right;">Back</a>
<script>
    let images = {{ bagatelle_data | safe }}
</script>
<script src="/static/js/gallery.js" type="module"></script>
